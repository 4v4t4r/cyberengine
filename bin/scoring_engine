#!/usr/bin/env ruby
$:.unshift File.join(File.dirname(__FILE__), '..', 'lib')

require 'scoring_engine'

require 'ostruct'
require 'optparse'

default_config_file = "#{File.dirname(__FILE__)}/../config.yaml"

options = OpenStruct.new
opts = OptionParser.new()
opts.banner = "Usage: #{$0} -c <Config File>"
opts.on("-c CONFIG_FILE", String, "Config file (Default to #{default_config_file})") do |config_file|
  options.config_file = config_file
end
opts.on("-v", "Boolean to turn on verbosity") do
  options.verbosity = true
end
opts.on_tail("-h", "--help", "Show this message") do
  puts opts
  exit
end
opts.parse!

ScoringEngine::Logger.level = Logger::INFO
ScoringEngine::Logger.level = Logger::DEBUG if options.verbosity

if options.config_file.nil?
  config_file = default_config_file
else
  config_file = options.config_file
end

config = ScoringEngine::Config.new(config_file)

engine = ScoringEngine::Engine.new(config["checks_location"])
engine.start(["google.com","yahoo.com"])